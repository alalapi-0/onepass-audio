<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- 基础页面信息与样式引用 -->
    <title>OnePass Audio 可视化控制台</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- 全局提示容器与解析错误提示区域 -->
    <div id="toast-container"></div>
    <div id="parse-error" class="parse-error hidden" role="alert" aria-live="assertive"></div>

    <!-- 顶部状态栏，展示后端 API 状态 -->
    <div class="status-bar">
      <span id="api-status-badge" class="status-badge status-badge--pending">API 状态检测中…</span>
    </div>

    <!-- 主体布局：左侧为素材列表，右侧为波形与区域操作 -->
    <div class="app-shell">
      <aside class="sidebar">
        <header class="sidebar__header">
          <h1>OnePass 控制台</h1>
          <p class="sidebar__desc">选择音频与标记，快速审听与导出。</p>
          <button id="refresh-button" type="button" class="sidebar__refresh">重新扫描 out/</button>
        </header>
        <!-- 侧边栏用于展示按 stem 聚合的音频与标记 -->
        <div class="sidebar__list" id="file-groups"></div>
      </aside>
      <main class="main">
        <!-- 顶部三栏展示当前选择的音频、标记与 stem -->
        <section class="selection-bar">
          <div class="selection-bar__item">
            <span class="label">当前音频</span>
            <span id="current-audio" class="selection-bar__value">未选择</span>
          </div>
          <div class="selection-bar__item">
            <span class="label">当前标记</span>
            <span id="current-marker" class="selection-bar__value">未选择</span>
          </div>
          <div class="selection-bar__item">
            <span class="label">Stem</span>
            <span id="current-stem" class="selection-bar__value">-</span>
          </div>
        </section>

        <!-- 播放与批量操作控制区 -->
        <section class="controls">
          <div class="controls__group">
            <button id="play-toggle" type="button">播放 / 暂停 (Space)</button>
            <button id="seek-back" type="button">⏪ -5s</button>
            <button id="seek-forward" type="button">⏩ +5s</button>
            <button id="skip-toggle" type="button" class="active">跳过删除段</button>
          </div>
          <div class="controls__group">
            <label for="zoom-range">缩放</label>
            <input id="zoom-range" type="range" min="20" max="400" step="10" value="120" />
          </div>
          <div class="controls__group controls__group--bulk">
            <button data-bulk="delete" type="button">全部设为删除</button>
            <button data-bulk="keep" type="button">全部设为保留</button>
            <button data-bulk="undecided" type="button">全部设为未决</button>
          </div>
        </section>

        <!-- 波形容器，WaveSurfer 会在此渲染音频曲线 -->
        <section class="waveform-section">
          <div id="waveform" class="waveform"></div>
        </section>

        <!-- 区域工具栏，说明快捷键并提供导出按钮 -->
        <section class="region-toolbar">
          <div class="region-toolbar__left">
            <span>Alt+拖拽创建区域，Delete 删除，D 切换状态，←/→ 选择邻近区域。</span>
          </div>
          <div class="region-toolbar__right">
            <button id="export-edl" type="button">导出 EDL (Ctrl+S)</button>
            <button id="export-markers" type="button">导出 Audition CSV</button>
          </div>
        </section>

        <!-- 区域列表表格，实时展示当前片段的时间与状态 -->
        <section class="region-list-section">
          <table class="region-table">
            <thead>
              <tr>
                <th>#</th>
                <th>状态</th>
                <th>开始</th>
                <th>结束</th>
                <th>时长</th>
                <th>描述</th>
              </tr>
            </thead>
            <tbody id="region-tbody"></tbody>
          </table>
        </section>
      </main>
    </div>

    <!-- 引入波形渲染依赖与主逻辑脚本 -->
    <script src="vendor/wavesurfer.min.js"></script>
    <script src="vendor/regions.min.js"></script>
    <script src="app.js" type="module"></script>
  </body>
</html>
