# align.py

- 最后更新时间：2025-11-02 01:32:41 +0900

## 功能概述
实现句子级文本与 ASR 词级时间戳之间的模糊匹配逻辑，是“保留最后一遍”流程的基础组件。模块利用 RapidFuzz 对比规范化后的 token 序列，枚举可能的词窗口并挑选得分最高且最晚出现的匹配结果，从而为每句话提供一个最佳保留区间。

## 关键职责
- 定义 `MatchWindow` 与 `AlignResult` 数据类，用于描述匹配窗口、重复命中和未对齐句子索引。
- 提供 `_join_tokens` 等辅助函数，将 token 序列转为便于比较的字符串形式。
- `align_sentences` 函数根据句长动态调整窗口范围与得分阈值，输出保留窗口、重复窗口以及未对齐列表。
